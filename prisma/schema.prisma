generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Session {
  id                  String    @id
  shop                String
  state               String
  isOnline            Boolean   @default(false)
  scope               String?
  expires             DateTime?
  accessToken         String
  userId              BigInt?
  firstName           String?
  lastName            String?
  email               String?
  accountOwner        Boolean   @default(false)
  locale              String?
  collaborator        Boolean?  @default(false)
  emailVerified       Boolean?  @default(false)
  refreshToken        String?
  refreshTokenExpires DateTime?
}

model Product {
  id             Int               @id @default(autoincrement())
  shop           String
  prodId         String            @unique
  title          String
  description    String?
  tags           String[]
  collection     String[]
  options        Json
  price          Float
  stock          Int
  handle         String?
  image          String?
  isSynced       Boolean           @default(false)
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  faqs           ProductFAQ[]
  variants       ProductVariant[]
  inCampaigns    CampaignProduct[]

  @@index([shop])
}

model ProductVariant {
  id        Int     @id @default(autoincrement())
  title     String
  sku       String
  image     String?
  option    String
  stock     Int
  productId Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

model ProductFAQ {
  id        String   @id @default(uuid())
  question  String
  answer    String
  productId Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id])

  @@index([productId])
}

model Campaign {
  id              String            @id @default(uuid())
  shop            String
  name            String
  description     String?
  responseMessage String?
  isActive        Boolean           @default(true)
  triggerKeywords String[]
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  products        CampaignProduct[]

  @@index([shop])
}

model CampaignProduct {
  id         String   @id @default(uuid())
  campaignId String
  productId  String
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  Product    Product  @relation(fields: [productId], references: [prodId], onDelete: Cascade)

  @@unique([campaignId, productId])
  @@index([campaignId])
  @@index([productId])
}

model Discount {
  id          String    @id @default(uuid())
  shop        String
  shopifyId   String    @unique
  title       String
  code        String
  startsAt    DateTime
  endsAt      DateTime?
  status      String
  isSuggested Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([shop])
}

model FAQ {
  id        String   @id @default(uuid())
  shop      String
  question  String
  answer    String
  category  String   @default("General")
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([shop])
  @@index([shop, category])
}

model AISettings {
  id        String   @id @default(uuid())
  shop      String   @unique
  settings  Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([shop])
}

model ChatbotCustomization {
  id        String   @id @default(uuid())
  shop      String   @unique
  settings  Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([shop])
}

model ChatConfiguration {
  id                         String   @id @default(uuid())
  shop                       String   @unique
  aiEnabled                  Boolean  @default(true)
  autoHandoffEnabled         Boolean  @default(true)
  useKeywordResponses        Boolean  @default(true)
  discountSuggestionsEnabled Boolean  @default(true)
  faqEnabled                 Boolean  @default(true)
  campaignsEnabled           Boolean  @default(true)
  maxTokensPerResponse       Int      @default(500)
  maxConcurrentRequests      Int      @default(5)
  rateLimitPerMinute         Int      @default(60)
  fallbackMessage            String?
  manualChatNotification     String?
  createdAt                  DateTime @default(now())
  updatedAt                  DateTime @updatedAt

  @@index([shop])
}

model Customer {
  id          String        @id @default(uuid())
  shopifyId   String?       @unique
  email       String
  firstName   String?
  lastName    String?
  phone       String?
  source      String        @default("SHOPIFY")
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  shop        String

  @@unique([shop, email])
  @@index([shop, email])
}


model StorePolicy {
  id        String   @id @default(uuid())
  shop      String
  title     String
  body      String
  url       String?
  type      String // e.g., "PRIVACY_POLICY", "REFUND_POLICY", etc.
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([shop, type])
  @@index([shop])
}
